@(form:Form[SelectInfo],types:TypeCards,listCards:List[Cards],listFirmware:List[Firmware],stockUsed:List[(reactivemongo.bson.BSONObjectID,Int)],state:Map[reactivemongo.bson.BSONObjectID,String],trie:String,sens:Int,id:String)(implicit request: Request[AnyContent])

@main(Messages("inventary.module.title")){
  @navigation("inventary")
  <div class="container">
    @inventary("module")
    <section>
      @module.stateForm("cards")
      <article class="col-sm-10">
        <div class="row">
          <div class="col-sm-12">
            <h4>@{types.types} / @{types.modele}</h4>
          </div>
          <div class="col-sm-11 col-sm-offset-1">
            <div class="row"> <span class="bold">@Messages("inventary.typeCards.stock")</span> : @listCards.size / @{listCards.size+stockUsed.head._2}</div>
          </div>
        </div>
        @if(listCards.size>0){
          <div class="row">
            <div class="col-sm-offset-10 col-sm-2">
              <div class="input-group-btn">
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false" style="width: 100%">@Messages("global.sort") <span class="caret"></span></button>
                <ul class="dropdown-menu" role="menu">
                @for(col<-List[String]("id","acquisition","firstUse","agregateur","apolline","etat")){
                  <li>
                    <a href="@routes.ModuleManager.formCards(types._id.stringify,col,if(trie.equals(col)){-sens}else{1},id)">
                      @if(trie.equals(col)){<span class="glyphicon glyphicon-ok"></span>}
                      @Messages("inventary.card."+col)
                    </a>
                  </li>
                }
                </ul>
              </div>
            </div>
          </div>
          @helper.form(action=routes.ModuleManager.addCards(types._id.stringify)) {
            <div class="row table-responsive">
              <table class="table table-hover table-bordered">
                <thead>
                  <tr>
                    <th></th>
                    <th>@Messages("inventary.card.id")</th>
                    <th>@Messages("inventary.card.acquisition")</th>
                    <th>@Messages("inventary.card.firstUse")</th>
                    <th>@Messages("inventary.card.firmware")</th>
                    <th>@Messages("inventary.card.agregateur")</th>
                    <th>@Messages("inventary.card.apolline")</th>
                    <th>@Messages("inventary.card.etat")</th>
                  </tr>
                </thead>
                <tbody>
                @for(mod <- listCards) {
                  <tr>
                    <td><input type="checkbox" name="elements[]" value="@mod._id.stringify"/></td>
                    <td>@mod.id</td>
                    <td>@{SensorManager.format(mod.acquisition)}</td>
                    <td>@if(mod.firstUse.nonEmpty){@{SensorManager.format(mod.firstUse.get)}} else {-}</td>
                    <td>@defining(listFirmware.filter(firm => firm._id.equals(mod.firmware))){ firm =>@firm.head.nom (@firm.head.version)}</td>
                    <td>@if(mod.agregateur) {@Messages("global.yes")} else {@Messages("global.no")}</td>
                    <td>@mod.apolline.getOrElse("-")</td>
                    <td>@if(mod.hs){@Messages("inventary.card.hs")}@if(mod.hs && state.getOrElse(mod._id,"").nonEmpty){<br/>}@state.getOrElse(mod._id,"")</td>
                  </tr>
                }
                </tbody>
              </table>
            </div>
            <p>
              <span style="float:right">
                <input type="submit" value="@Messages("global.btn.submit")" class="btn btn-default"/>
                <a href="@routes.ModuleManager.formTypeSensors()" class="btn btn-default">@Messages("inventary.module.nextState")</a>
              </span>
            </p>
          }
        }else{
          <h3 style="text-align:center">@Messages("global.error.noResult")</h3>
          <p>
            <span style="float:right">
              <a href="@routes.ModuleManager.formTypeSensors()" class="btn btn-default">@Messages("inventary.module.nextState")</a>
            </span>
          </p>
        }
      </article>
      <nav class="col-sm-2">
        <div class="search_lateral">
        @helper.form(action=routes.ModuleManager.formCards(types._id.stringify)){
          <div class="input-group">
            <div class="input-group-addon"><span class="glyphicon glyphicon-search"></span></div>
            <input type="search" name="id" class="form-control" value="@id" placeholder="@Messages("inventary.card.id")"/>
            <input type="hidden" name="sort" value="@trie"/>
            <input type="hidden" name="sens" value="@sens"/>
          </div>
        }
        </div>
      </nav>
    </section>
  </div>
}