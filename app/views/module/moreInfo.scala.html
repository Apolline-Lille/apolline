@(mod:Module,state:String,typesCards:List[TypeCards],cards:List[Cards],listFirmware:List[Firmware],typeSensors:List[TypeSensor],espece:List[Espece],typeMesure:List[TypeMesure],sensors:List[Sensor],previous:String,configurations:List[Configuration])(implicit request:Request[AnyContent])

@main(Messages("inventary.module.title")) {
  @navigation("inventary")
  <div class="container">
    @inventary("module")
    <section>
      <article class="col-sm-10">
        <a href="@previous#@mod._id.stringify"><span class="glyphicon glyphicon-arrow-left"></span> Retour</a>
        <div class="col-sm-12">
          <h4>@mod.types / @mod.id</h4>
        </div>
        <div class="col-sm-11 col-sm-offset-1">
          <div class="row"><span class="bold">@Messages("inventary.module.commentaire")</span> : @mod.commentaire</div>
          <div class="row"><span class="bold">@Messages("inventary.module.dateAssemblage")</span> : @SensorManager.format(mod.dateAssemblage)</div>
          <div class="row">
            <span class="bold">@Messages("inventary.module.onglet.cards")</span> :
            <ul>
            @for(typeCard <- typesCards) {
              <li>
                <h5 class="bold">@typeCard.types / @typeCard.modele</h5>
                <div class="table-responsive">
                  <table class="table table-hover table-bordered">
                    <thead>
                      <tr>
                        <th>@Messages("inventary.card.id")</th>
                        <th>@Messages("inventary.card.acquisition")</th>
                        <th>@Messages("inventary.card.firstUse")</th>
                        <th>@Messages("inventary.card.firmware")</th>
                        <th>@Messages("inventary.card.agregateur")</th>
                        <th>@Messages("inventary.card.apolline")</th>
                        <th>@Messages("inventary.card.etat")</th>
                      </tr>
                    </thead>
                    <tbody>
                    @for(mod <- cards.filter(p => p.types.equals(typeCard._id))) {
                      <tr>
                        <td>@mod.id</td>
                        <td>@{SensorManager.format(mod.acquisition)}</td>
                        <td>@if(mod.firstUse.nonEmpty) {@{SensorManager.format(mod.firstUse.get)}} else {-}</td>
                        <td>@defining(listFirmware.filter(firm => firm._id.equals(mod.firmware))) { firm =>@firm.head.nom (@firm.head.version)}</td>
                        <td>@if(mod.agregateur) { @Messages("global.yes") } else { @Messages("global.no") }</td>
                        <td>@mod.apolline.getOrElse("-")</td>
                        <td>@if(mod.hs){@Messages("inventary.card.hs")}@if(mod.hs && state!=null){<br/>}@state</td>
                      </tr>
                    }
                    </tbody>
                  </table>
                </div>
              </li>
            }
            </ul>
          </div>
          <div class="row">
            <span class="bold">@Messages("inventary.module.onglet.sensors")</span> :
            <ul>
            @for(types <- typeSensors) {
              <li>
                <h5 class="bold">@types.nomType / @types.modele</h5>
                <div class="row">
                  <div class="col-sm-11 col-sm-offset-1">
                    <div class="row"> <span class="bold">@Messages("inventary.typeSensor.fabricant")</span> : @types.fabricant</div>
                    <div class="row"> <span class="bold">@Messages("inventary.typeSensor.nbSignaux")</span> : @{
                      types.nbSignaux
                    }</div>
                    <div class="row">
                      <span class="bold">@Messages("inventary.typeSensor.espece")</span> :
                      <div class="col-sm-10 col-sm-offset-1 table-responsive">
                        <table class="table table-hover table-bordered">
                          <thead>
                            <tr>
                              <th>@Messages("inventary.typeSensor.nomEspece")</th>
                              <th>@Messages("inventary.typeSensor.mesure")</th>
                              <th>@Messages("inventary.typeSensor.signalMin")</th>
                              <th>@Messages("inventary.typeSensor.signalMax")</th>
                            </tr>
                          </thead>
                          <tbody>
                          @for(esp <- types.espece) {
                            @defining(espece.find(p => p._id.equals(esp))) {currentEsp=>
                              @if(currentEsp.nonEmpty){
                                @defining(typeMesure.find(p=>p._id.equals(currentEsp.get.mesure))){mesure=>
                                  @if(mesure.nonEmpty){
                                    <tr>
                                      <td>@currentEsp.get.espece</td>
                                      <td>@mesure.get.nom</td>
                                      <td>@currentEsp.get.min @mesure.get.unite</td>
                                      <td>@currentEsp.get.max @mesure.get.unite</td>
                                    </tr>
                                  }
                                }
                              }
                            }
                          }
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="table-responsive">
                  <table class="table table-hover table-bordered">
                    <thead>
                      <tr>
                        <th>@Messages("inventary.sensor.id")</th>
                        <th>@Messages("inventary.sensor.acquisition")</th>
                        <th>@Messages("inventary.sensor.expiration")</th>
                        <th>@Messages("inventary.sensor.firstUse")</th>
                        <th>@Messages("inventary.sensor.etat")</th>
                      </tr>
                    </thead>
                    <tbody>
                    @for(sensor <- sensors.filter(p => p.types.equals(types._id))) {
                      <tr>
                        <td>@sensor.id</td>
                        <td>@{SensorManager.format(sensor.acquisition)}</td>
                        <td>@if(sensor.expiration.nonEmpty) {@{SensorManager.format(sensor.expiration.get)}} else {-}</td>
                        <td>@if(sensor.firstUse.nonEmpty) {@{SensorManager.format(sensor.firstUse.get)}} else {-}</td>
                        <td>@if(sensor.hs) {@Messages("inventary.sensor.hs")}@if(sensor.hs && state!=null){<br/>}@state</td>
                      </tr>
                    }
                    </tbody>
                  </table>
                </div>
              </li>
            }
            </ul>
          </div>
          <div class="row">
            <span class="bold">@Messages("inventary.module.configuration")</span> :
            <div class="table-responsive">
              <table class="table table-hover table-bordered">
                <thead>
                  <tr>
                    <th>@Messages("inventary.configuration.port")</th>
                    <th>@Messages("inventary.configuration.types")</th>
                    <th>@Messages("inventary.configuration.numberOfValue")</th>
                    <th>@Messages("inventary.configuration.timeFilter")</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  @for(config<-configurations){
                    <tr>
                      <td>@config.port</td>
                      <td>@config.types</td>
                      <td>@config.numberOfValue</td>
                      <td>@config.timeFilter</td>
                      <td>
                        <a href="@routes.ConfigurationManager.configuration(mod._id.stringify,config._id.stringify)" data-toggle-tooltip title="@Messages("global.tooltip.detail")"><span class="glyphicon glyphicon-info-sign"></span></a>
                        <a href="@routes.ConfigurationManager.formUpdate(mod._id.stringify,config._id.stringify)" data-toggle-tooltip title="@Messages("global.tooltip.update")"><span class="glyphicon glyphicon-pencil"></span></a>
                        @*<a data-toggle="modal" href="#modal-delete" data-toggle-tooltip title="@Messages("global.tooltip.delete")" data-title="@mod.id" data-link="#">
                          <span class="glyphicon glyphicon-trash"></span>
                        </a>*@
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
          </div>
        </div>
      </article>
      <nav class="col-sm-2">
        <a href="@routes.ConfigurationManager.formConfiguration(mod._id.stringify)" class="btn btn-success btn-sm">
          <span class="glyphicon glyphicon-plus"></span>
          @Messages("inventary.module.addConfig")
        </a>
        <a href="@routes.ConfigurationManager.downloadConfiguration(mod._id.stringify)" class="btn btn-default btn-sm">
          <span class="glyphicon glyphicon-cloud-download"></span>
          Télécharger configurations
        </a>
      </nav>
    </section>
  </div>
}